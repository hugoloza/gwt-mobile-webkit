# Introduction #
## Context ##
The [Application Cache feature](http://www.w3.org/TR/html5/offline.html) describes a cache manifest resource which describes all resources which are accessed by the web application. Some of these resources are _static_, and others are _dynamic_ (meaning, a network RPC-kind of resource).

The browser (at least, iPhone Safari) loads the cache-manifest and immediately obtains all resources in the manifest. The manifest is from this point regarded as a proxy to the actual **internet** (not just the originating web server), so if the app tries to load a resource _not_ listed in the manifest, it is rewarded a `404 NOT_FOUND` and the resource is not loaded.

## Problems ##
Here we found several problems we can't solve with the current status quo:
  1. The cache-manifest must be set in the `<html>` tag of the `index.html` page in order to be effective. This means the manifest must list **all permutation resources** generated by GWT, obviously resulting in a **large network overhead** in initial loading time;
  1. If the cache-manifest must be permutation-specific (to narrow down the pointless network overhead) the browser **should get to a page representing a particular permutation**;
  1. If the user is redirected to a different page, the user **should be able to bookmark the page** for later reference (and effective offline access);
  1. Not just the cacheable resources, **all other resources must be listed in the manifest**. This means the AppCache library must be provided some means to **detect a new version of the webapp**, so it can update its cache.

# Proposed solution #
The IFrameLinker (which is the default linker in GWT) seems to be the best extension point for this effort. We need to:
  1. add a `manifest` attribute to the `<html>` tag of the landing page pointing to the _general_ cache-manifest. This manifest lists all resources referred to from the landing page (like CSS) and the permutation-specific HTML resources (`5646ABCDEF565.cache.html`) as CACHE entries;
  1. Split the permutation-specific HTML generated by the IFrameTemplate in two parts: One is the basic HTML document (which is just a wrapper for the `<script>` tag), and the other is the included permutation-specific Javascript;
  1. The permutation-specific HTML gets its own `manifest` attribute pointing to a permutation-specific cache-manifest resource. That cache-manifest lists just the included permutation Javascript as CACHE entry.
  1. Collect the `NetworkArtifact` instances generated by the `ApplicationCacheNetworkSectionGenerator` and translate them to entries in the NETWORK section of all permutation-specific cache-manifests resources;
  1. Collect the static resources emitted from GWT and store these as entries in the appropriate cache-manifest resources.

The output from the linker should work on all GWT supported browsers, including browsers which don't provide support for the Application Cache feature. In that case, the cache is simply ignored and all resources are requested normally.

Also, the output should work perfectly well in Hosted Mode too.